<body class="body-class">
	<%= render '/shared/signup_modal' %>
	<%= render '/shared/login_modal' %>
	<%= render '/shared/nav' %>
	<%= render '/settings/add_bank_modal' %>
	<% if current_user && current_user == @user %>
		<% if @account.verification.disabled_reason == "fields_needed" %>
			<%= render '/settings/fields_needed' %>
		<% else %>
			<%= render '/settings/withdraw_section' %>
		<% end %>

		<div class="wd-accounts-section">
			<div class="w-container wd-accounts-container">
				<h3 class="wd-accounts-title">Accounts</h3>
				<table class="wd-accounts-table">
					<% @bank_accounts.each do |b| %>
					<tr>
						<td class="wd-accounts-table-tr"><%= '***' + b.last4 + ' ' + b.bank_name %></td>
						<td class="wd-accounts-table-tr">
							<% if b.default_for_currency == true %>
								<%= 'Default' %>
							<% else %>
								<%= link_to 'Set Default', stripe_infos_default_bank_account_path(id: b.id), method: :post, class: "link-to" %>
							<% end %>
						</td>
						<td class="wd-accounts-table-tr"><%= link_to 'Remove', stripe_infos_remove_bank_account_path(id: b.id), method: :post, class: "link-to" %></td>
					</tr>
					<% end %>
				</table>
				<a class="w-button wd-accounts-button" data-ix="add-bank-button" href="#">Add Account</a>
			</div>
		</div>
		<div class="wd-history-section">
			<div class="w-container wd-history-container">
				<h3 class="wd-history-title">Withdrawal History</h3>
				<table class="wd-history-table">
					<tr>
						<th class="wd-history-table-tr">Withdrawal Date</th>
						<th class="wd-history-table-tr">Completion Date</th>
						<th class="wd-history-table-tr">Account</th>
						<th class="wd-history-table-tr">Amount</th>
						<th class="wd-history-table-tr">Status</th>
					</tr>
					<% @payout_list.each do |p| %>
						<tr>
							<td class="wd-history-table-tr"><%= Time.zone.at(p.created).strftime("%B %d, %Y") %></td>
							<td class="wd-history-table-tr"><%= Time.zone.at(p.arrival_date).strftime("%B %d, %Y") %></td>
							<td class="wd-history-table-tr"><%= p.destination %></td><!-- TODO: Fix this to lookup BankAccount info using p.destination -->
							<td class="wd-history-table-tr">$<%= '%.2f' % (p.amount / 100.0) %> USD</td>
							<td class="wd-history-table-tr"><%= p.status %></td>
						</tr>
					<% end %>

				</table>
			</div>
		</div>
	<% else %>
	You are not allowed to access this page
	<% end %>
</body>
<footer>
	<%= render '/shared/footer' %>
</footer>
